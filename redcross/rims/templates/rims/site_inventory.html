{% extends "rims/sites.html" %}
{% block breadcrumbs %}
    {{ block.super }}
    &raquo;
    <a href="{% url 'rims:site_inventory' site.number %}">site inventory</a>
{% endblock breadcrumbs %}
{% block content %}
    {% if site %}
        <h2>Site: {{ site.name }}</h2>
        <form action="{% url 'rims:site_inventory' site.number %}" method="post">
            {% csrf_token  %}
            <input type="submit" value="Save" name="Save">
        <h3>Inventory:</h3>
        {% if inventory %}
            {# cycle template tag from future is auto-escaping #}
            {% load cycle from future %}
            Inventory Items With Errors: {{ site.num_inventory_errors }}<br/>
            </p>
            <div class="detail-form">
                <table id="site-detail-form">
                {{ productsForms.management_form }}
                {% for productForm in productsForms %}
                    {% if forloop.first %}
                        <thead><tr class="detail-form-header">
                            <th>Inventory Item</th>
                            {% for field in productForm.visible_fields %}
                                <th>{{ field.label | capfirst }}</th>
                            {% endfor %}
                        </tr></thead>
                    {% endif %}
                    <tr class="{% cycle row1,row2 %}">
                        <td class=
                        {% if productForm.instance.check_quantity %}
                            "detail-table-text"
                        {% else %}
                            "detail-table-error-text"
                        {% endif %}
                        ><a class="pkt-link" href="{% url 'rims:product_detail' productForm.instance.information.code %}"
                         title="{% if productForm.instance.check_information %}get item details{% else %}get item details, some errors{% endif %}">
                        {{ productForm.instance.information.name }}
                        </a></td> 
                        {% for field in productForm.visible_fields %}
                            <td class="{{ field.css_classes }}" title="{{ field.errors | escape}}">
                                {# Include the hidden fields in the form #}
                                {% if forloop.first %}
                                    {% for hidden in productForm.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
                                {% endif %}
                                {# {{ field.errors }} #}
                                {{ field }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
                </table>
            </div>
        {% else %}
            No inventory at this site
        {% endif %}
        </form>
    {% else %}
        No site found
    {% endif %}
{% endblock content %}